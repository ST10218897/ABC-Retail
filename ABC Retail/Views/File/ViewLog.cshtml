@{
    ViewData["Title"] = "View Log File";
}

<h1>View Log File</h1>

<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">@ViewBag.FileName</h5>
                <div>
                    <a asp-action="DownloadLog" asp-route-fileName="@ViewBag.FileName" class="btn btn-success btn-sm">
                        <i class="fas fa-download"></i> Download
                    </a>
                    <a asp-action="Index" class="btn btn-secondary btn-sm">Back to Files</a>
                </div>
            </div>
            <div class="card-body">
                @if (!string.IsNullOrEmpty(ViewBag.Content))
                {
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i>
                        Log file content from Azure File Storage
                    </div>
                    
                    <div class="log-content-container">
                        <pre class="log-content">@ViewBag.Content</pre>
                    </div>
                    
                    <div class="mt-3">
                        <h6>Log Statistics:</h6>
                        <div class="row">
                            <div class="col-md-3">
                                <div class="border rounded p-2 text-center">
                                    <div class="text-primary font-weight-bold">@(ViewBag.Content.Split('\n').Length)</div>
                                    <small class="text-muted">Lines</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="border rounded p-2 text-center">
                                    <div class="text-primary font-weight-bold">@(ViewBag.Content.Length)</div>
                                    <small class="text-muted">Characters</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="border rounded p-2 text-center">
                                    <div class="text-primary font-weight-bold">@(ViewBag.Content.Split(' ').Length)</div>
                                    <small class="text-muted">Words</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="border rounded p-2 text-center">
                                    <div class="text-primary font-weight-bold">@DateTime.Now.ToString("yyyy-MM-dd HH:mm")</div>
                                    <small class="text-muted">Viewed</small>
                                </div>
                            </div>
                        </div>
                    </div>
                }
                else
                {
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle"></i>
                        No content found for log file: <strong>@ViewBag.FileName</strong>
                    </div>
                }
            </div>
            <div class="card-footer">
                <div class="row">
                    <div class="col-md-6">
                        <small class="text-muted">
                            <i class="fas fa-file-alt"></i> 
                            Log file from Azure File Storage
                        </small>
                    </div>
                    <div class="col-md-6 text-right">
                        <small class="text-muted">
                            Retrieved: @DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss")
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h6 class="card-title mb-0">Log File Actions</h6>
            </div>
            <div class="card-body">
                <a asp-action="DownloadLog" asp-route-fileName="@ViewBag.FileName" class="btn btn-success btn-block mb-2">
                    <i class="fas fa-download"></i> Download Log
                </a>
                <form asp-action="DeleteLog" method="post" class="mb-2">
                    <input type="hidden" name="fileName" value="@ViewBag.FileName" />
                    <button type="submit" class="btn btn-danger btn-block" 
                            onclick="return confirm('Are you sure you want to delete this log file?')">
                        <i class="fas fa-trash"></i> Delete Log
                    </button>
                </form>
                <a asp-action="Index" class="btn btn-secondary btn-block">
                    <i class="fas fa-list"></i> Back to Files
                </a>
            </div>
        </div>
    </div>
    
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h6 class="card-title mb-0">Log File Information</h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>File Details:</h6>
                        <ul class="list-unstyled small">
                            <li><strong>Name:</strong> @ViewBag.FileName</li>
                            <li><strong>Type:</strong> Log File</li>
                            <li><strong>Storage:</strong> Azure File Storage</li>
                            <li><strong>Accessed:</strong> @DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss")</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6>Content Analysis:</h6>
                        <ul class="list-unstyled small">
                            <li><i class="fas fa-lines text-info"></i> Lines: @(ViewBag.Content?.Split('\n').Length ?? 0)</li>
                            <li><i class="fas fa-font text-info"></i> Characters: @(ViewBag.Content?.Length ?? 0)</li>
                            <li><i class="fas fa-words text-info"></i> Words: @(ViewBag.Content?.Split(' ').Length ?? 0)</li>
                            <li><i class="fas fa-clock text-info"></i> Retrieved: @DateTime.Now.ToString("HH:mm:ss")</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .log-content-container {
        max-height: 400px;
        overflow-y: auto;
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 0.25rem;
        padding: 1rem;
    }
    
    .log-content {
        white-space: pre-wrap;
        word-break: break-all;
        font-family: 'Courier New', monospace;
        font-size: 0.9rem;
        margin: 0;
        color: #212529;
    }
</style>

@section Scripts {
    <script>
        // Add syntax highlighting for common log patterns
        document.addEventListener('DOMContentLoaded', function() {
            const logContent = document.querySelector('.log-content');
            if (logContent) {
                const text = logContent.textContent;
                
                // Simple highlighting for error levels
                const highlightedText = text
                    .replace(/(ERROR|Error|error)/g, '<span class="text-danger">$1</span>')
                    .replace(/(WARN|Warn|warn|WARNING|Warning|warning)/g, '<span class="text-warning">$1</span>')
                    .replace(/(INFO|Info|info)/g, '<span class="text-info">$1</span>')
                    .replace(/(DEBUG|Debug|debug)/g, '<span class="text-secondary">$1</span>');
                
                logContent.innerHTML = highlightedText;
            }
        });
    </script>
}
